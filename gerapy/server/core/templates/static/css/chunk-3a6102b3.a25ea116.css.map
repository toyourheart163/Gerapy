{"version":3,"sources":["webpack:///src/views/project/src/views/project/Deploy.vue","chunk-3a6102b3.a25ea116.css"],"names":[],"mappings":"AAmTA,mBACA,eCjTA","file":"chunk-3a6102b3.a25ea116.css","sourcesContent":["<template>\n\t<div>\n\t\t<el-row :gutter=\"20\">\n\t\t\t<el-col :span=\"24\">\n\t\t\t\t<div class=\"panel\">\n\t\t\t\t\t<panel-title :title=\"$lang.titles.deployProject\">\n\t\t\t\t\t</panel-title>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<el-table\n\t\t\t\t\t\t\t:data=\"clients\"\n\t\t\t\t\t\t\tv-loading=\"loading\"\n\t\t\t\t\t\t\t:element-loading-text=\"$lang.messages.loading\"\n\t\t\t\t\t\t\t@selection-change=\"onBatchSelect\"\n\t\t\t\t\t\t\t:style=\"{width: '100%'}\">\n\t\t\t\t\t\t\t<el-table-column\n\t\t\t\t\t\t\t\talign=\"center\"\n\t\t\t\t\t\t\t\ttype=\"selection\"\n\t\t\t\t\t\t\t\twidth=\"55\">\n\t\t\t\t\t\t\t</el-table-column>\n\t\t\t\t\t\t\t<el-table-column\n\t\t\t\t\t\t\t\talign=\"center\"\n\t\t\t\t\t\t\t\t:label=\"$lang.columns.status\"\n\t\t\t\t\t\t\t\twidth=\"100\">\n\t\t\t\t\t\t\t\t<template slot-scope=\"props\">\n\t\t\t\t\t\t\t\t\t<el-button :type=\"statusClass[clientsStatus[props.row.pk]]\" size=\"mini\">\n\t\t\t\t\t\t\t\t\t\t{{ statusText[clientsStatus[props.row.pk]] }}\n\t\t\t\t\t\t\t\t\t</el-button>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</el-table-column>\n\t\t\t\t\t\t\t<el-table-column\n\t\t\t\t\t\t\t\talign=\"center\"\n\t\t\t\t\t\t\t\tprop=\"pk\"\n\t\t\t\t\t\t\t\t:label=\"$lang.columns.id\"\n\t\t\t\t\t\t\t\twidth=\"60\">\n\t\t\t\t\t\t\t</el-table-column>\n\t\t\t\t\t\t\t<el-table-column\n\t\t\t\t\t\t\t\talign=\"center\"\n\t\t\t\t\t\t\t\tprop=\"fields.name\"\n\t\t\t\t\t\t\t\t:label=\"$lang.columns.name\"\n\t\t\t\t\t\t\t\twidth=\"100\">\n\t\t\t\t\t\t\t</el-table-column>\n\t\t\t\t\t\t\t<el-table-column\n\t\t\t\t\t\t\t\talign=\"center\"\n\t\t\t\t\t\t\t\tprop=\"fields.ip\"\n\t\t\t\t\t\t\t\t:label=\"$lang.columns.ip\"\n\t\t\t\t\t\t\t\twidth=\"150\">\n\t\t\t\t\t\t\t</el-table-column>\n\t\t\t\t\t\t\t<el-table-column\n\t\t\t\t\t\t\t\talign=\"center\"\n\t\t\t\t\t\t\t\tprop=\"fields.port\"\n\t\t\t\t\t\t\t\t:label=\"$lang.columns.port\"\n\t\t\t\t\t\t\t\twidth=\"100\">\n\t\t\t\t\t\t\t</el-table-column>\n\t\t\t\t\t\t\t<el-table-column\n\t\t\t\t\t\t\t\talign=\"center\"\n\t\t\t\t\t\t\t\t:label=\"$lang.columns.description\">\n\t\t\t\t\t\t\t\t<template slot-scope=\"props\">\n\t\t\t\t\t\t\t\t\t<span>{{ projectDescriptions[props.row.pk]}}</span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</el-table-column>\n\t\t\t\t\t\t\t<el-table-column\n\t\t\t\t\t\t\t\talign=\"center\"\n\t\t\t\t\t\t\t\t:label=\"$lang.columns.deployedAt\">\n\t\t\t\t\t\t\t\t<template slot-scope=\"props\">\n\t\t\t\t\t\t\t\t\t<span>{{ projectDateTimes[props.row.pk]}}</span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</el-table-column>\n\t\t\t\t\t\t\t<el-table-column\n\t\t\t\t\t\t\t\talign=\"center\"\n\t\t\t\t\t\t\t\t:label=\"$lang.columns.operations\">\n\t\t\t\t\t\t\t\t<template slot-scope=\"props\">\n\t\t\t\t\t\t\t\t\t<el-button type=\"success\" size=\"mini\" @click=\"onDeploy(props.row.pk)\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t v-if=\"clientsStatus[props.row.pk]\">\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-cloud-upload\"></i>\n\t\t\t\t\t\t\t\t\t\t{{ $lang.buttons.deploy }}\n\t\t\t\t\t\t\t\t\t</el-button>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</el-table-column>\n\t\t\t\t\t\t</el-table>\n\t\t\t\t\t\t<bottom-bar>\n\t\t\t\t\t\t\t<el-button slot=\"handler\"\n\t\t\t\t\t\t\t\t\t\t\t\t type=\"primary\"\n\t\t\t\t\t\t\t\t\t\t\t\t size=\"mini\"\n\t\t\t\t\t\t\t\t\t\t\t\t :disabled=\"batchSelect.length === 0\"\n\t\t\t\t\t\t\t\t\t\t\t\t @click=\"onBatchDeploy\"\n\t\t\t\t\t\t\t\t\t\t\t\t slot-scope=\"handler\">\n\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-cloud-upload\"></i>\n\t\t\t\t\t\t\t\t\t\t{{ $lang.buttons.batchDeploy }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</el-button>\n\t\t\t\t\t\t</bottom-bar>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</el-col>\n\t\t</el-row>\n\t\t<el-row :gutter=\"20\">\n\t\t\t<el-col :span=\"12\">\n\t\t\t\t<div class=\"panel\">\n\t\t\t\t\t<panel-title :title=\"$lang.objects.project\">\n\t\t\t\t\t</panel-title>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<el-form :model=\"buildInfo\" label-width=\"120px\">\n\t\t\t\t\t\t\t<el-form-item :label=\"$lang.columns.name\">\n\t\t\t\t\t\t\t\t{{ buildInfo.name }}\n\t\t\t\t\t\t\t</el-form-item>\n\t\t\t\t\t\t\t<el-form-item :label=\"$lang.columns.packageName\">\n\t\t\t\t\t\t\t\t{{ buildInfo.egg || notBuildText }}\n\t\t\t\t\t\t\t</el-form-item>\n\t\t\t\t\t\t\t<el-form-item :label=\"$lang.columns.builtAt\">\n\t\t\t\t\t\t\t\t{{ buildInfo.built_at || notBuildText }}\n\t\t\t\t\t\t\t</el-form-item>\n\t\t\t\t\t\t</el-form>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</el-col>\n\t\t\t<el-col :span=\"12\">\n\t\t\t\t<div class=\"panel\">\n\t\t\t\t\t<panel-title :title=\"$lang.titles.buildProject\">\n\t\t\t\t\t</panel-title>\n\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t<el-form ref=\"form\" :model=\"buildInfo\" :rules=\"rules\" label-width=\"120px\">\n\t\t\t\t\t\t\t<el-form-item :label=\"$lang.columns.name\">\n\t\t\t\t\t\t\t\t{{ buildInfo.name }}\n\t\t\t\t\t\t\t</el-form-item>\n\t\t\t\t\t\t\t<el-form-item :label=\"$lang.columns.description\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tprop=\"description\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"description\">\n\t\t\t\t\t\t\t\t<el-input v-model=\"buildInfo.description\" size=\"small\"></el-input>\n\t\t\t\t\t\t\t</el-form-item>\n\t\t\t\t\t\t\t<el-form-item>\n\t\t\t\t\t\t\t\t<el-button type=\"primary\" size=\"small\" @click=\"onBuild\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-codepen\"></i>\n\t\t\t\t\t\t\t\t\t<span v-if=\"buildInfo.egg\"> {{ $lang.buttons.re\n                    }}</span>{{ $lang.buttons.build }}\n\t\t\t\t\t\t\t\t</el-button>\n\t\t\t\t\t\t\t</el-form-item>\n\t\t\t\t\t\t</el-form>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</el-col>\n\t\t</el-row>\n\t</div>\n</template>\n<script type=\"text/javascript\">\n\timport PanelTitle from '../../components/PanelTitle'\n\timport BottomBar from '../../components/BottomBar'\n\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tbuildInfo: {},\n\t\t\t\tnotBuildText: this.$store.getters.$lang.messages.notBuilt,\n\t\t\t\tclients: [],\n\t\t\t\tloading: false,\n\t\t\t\tprojectName: this.$route.params.name,\n\t\t\t\tbatchSelect: [],\n\t\t\t\tprojectDescriptions: {},\n\t\t\t\tprojectDateTimes: {},\n\t\t\t\tclientsStatus: {},\n\t\t\t\tstatusClass: {\n\t\t\t\t\t'1': 'success',\n\t\t\t\t\t'0': 'warning',\n\t\t\t\t\t'-1': 'danger',\n\t\t\t\t},\n\t\t\t\tstatusText: {\n\t\t\t\t\t'1': this.$store.getters.$lang.buttons.normal,\n\t\t\t\t\t'0': this.$store.getters.$lang.buttons.connecting,\n\t\t\t\t\t'-1': this.$store.getters.$lang.buttons.error,\n\t\t\t\t},\n\t\t\t\trules: {\n\t\t\t\t\tdescription: [\n\t\t\t\t\t\t{required: true, message: this.$store.getters.$lang.messages.emptyDescription, trigger: 'blur'},\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcomponents: {\n\t\t\tPanelTitle,\n\t\t\tBottomBar\n\t\t},\n\t\tcreated() {\n\t\t\tthis.getClientData()\n\t\t\tthis.getBuildInfo()\n\t\t},\n\t\tmethods: {\n\t\t\tonBatchSelect(val) {\n\t\t\t\tthis.batchSelect = val\n\t\t\t\tconsole.log(this.batchSelect)\n\t\t\t},\n\t\t\tgetBuildInfo() {\n\t\t\t\tthis.loading = true\n\t\t\t\tthis.$http.get(this.formatString(this.$store.state.url.project.build, {\n\t\t\t\t\tname: this.projectName\n\t\t\t\t})).then(({data: data}) => {\n\t\t\t\t\tthis.buildInfo = data\n\t\t\t\t\tconsole.log(data)\n\t\t\t\t\tthis.loading = false\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t})\n\t\t\t},\n\t\t\tgetClientStatus(id) {\n\t\t\t\tthis.$set(this.clientsStatus, id, 0)\n\t\t\t\tthis.$http.get(this.formatString(this.$store.state.url.client.status, {\n\t\t\t\t\tid: id\n\t\t\t\t})).then(({data: {result: data}}) => {\n\t\t\t\t\tthis.$set(this.clientsStatus, id, data)\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.$set(this.clientsStatus, id, -1)\n\t\t\t\t})\n\t\t\t},\n\t\t\tgetClientData() {\n\t\t\t\tthis.loading = true\n\t\t\t\tthis.$http.get(this.$store.state.url.client.index\n\t\t\t\t).then(({data: clients}) => {\n\t\t\t\t\tthis.clients = clients\n\t\t\t\t\tthis.loading = false\n\t\t\t\t\tthis.clients.forEach(({pk: id}) => {\n\t\t\t\t\t\tthis.getProjectVersion(id)\n\t\t\t\t\t\tthis.getClientStatus(id)\n\t\t\t\t\t})\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t})\n\t\t\t},\n\t\t\tdeploy(id) {\n\t\t\t\tif (this.clientsStatus[id]) {\n\t\t\t\t\tthis.$http.post(this.formatString(this.$store.state.url.client.projectDeploy, {\n\t\t\t\t\t\tid: id,\n\t\t\t\t\t\tname: this.projectName,\n\t\t\t\t\t})).then(() => {\n\t\t\t\t\t\tthis.$message.success(this.$store.getters.$lang.titles.client + ' ' + id + ' ' +\n\t\t\t\t\t\t\tthis.$store.getters.$lang.messages.successDeploy\n\t\t\t\t\t\t)\n\t\t\t\t\t\tthis.getProjectVersion(id)\n\t\t\t\t\t\tthis.loading = false\n\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\tthis.$message.error(this.$store.getters.$lang.titles.client + ' ' + id + ' ' + this.$store.getters.$lang.messages.errorDeploy)\n\t\t\t\t\t\tthis.loading = false\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tthis.$message.error(this.$store.getters.$lang.titles.client + ' ' + id + ' ' + this.$store.getters.$lang.messages.errorDeploy)\n\t\t\t\t\tthis.loading = false\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetProjectVersion(id) {\n\t\t\t\tthis.loading = true\n\t\t\t\tthis.$http.get(this.formatString(this.$store.state.url.client.projectVersion, {\n\t\t\t\t\tid: id,\n\t\t\t\t\tname: this.projectName,\n\t\t\t\t})).then(({data: version}) => {\n\t\t\t\t\tthis.$set(this.projectDescriptions, id, version['description'])\n\t\t\t\t\tthis.$set(this.projectDateTimes, id, version['deployed_at'])\n\t\t\t\t\tthis.loading = false\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t})\n\t\t\t},\n\t\t\tonBatchDeploy() {\n\t\t\t\tthis.$confirm(this.$store.getters.$lang.messages.confirm, this.$store.getters.$lang.buttons.confirm, {\n\t\t\t\t\tconfirmButtonText: this.$store.getters.$lang.buttons.yes,\n\t\t\t\t\tcancelButtonText: this.$store.getters.$lang.buttons.no,\n\t\t\t\t\ttype: 'warning'\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis.loading = true\n\t\t\t\t\tconsole.log(this.batchSelect)\n\t\t\t\t\tthis.batchSelect.forEach(({pk: id}) => {\n\t\t\t\t\t\tthis.deploy(id)\n\t\t\t\t\t})\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.$message.error(this.$store.getters.$lang.messages.errorDeploy)\n\t\t\t\t})\n\t\t\t},\n\t\t\tonDeploy(id) {\n\t\t\t\tif (this.buildInfo.egg) {\n\t\t\t\t\tthis.deploy(id)\n\t\t\t\t} else {\n\t\t\t\t\tthis.$message.error(this.$store.getters.$lang.messages.buildFirst)\n\t\t\t\t}\n\t\t\t},\n\t\t\tonBuild() {\n\t\t\t\tthis.$refs.form.validate((valid) => {\n\t\t\t\t\tif (!valid)\n\t\t\t\t\t\treturn false\n\t\t\t\t\tthis.$http.post(this.formatString(this.$store.state.url.project.build, {\n\t\t\t\t\t\tname: this.projectName\n\t\t\t\t\t}), {\n\t\t\t\t\t\tdescription: this.buildInfo['description'],\n\t\t\t\t\t\tegg: this.buildInfo['egg'],\n\t\t\t\t\t\tbuilt_at: this.buildInfo['built_at']\n\t\t\t\t\t}).then(({data: data}) => {\n\t\t\t\t\t\tthis.buildInfo = data\n\t\t\t\t\t\tconsole.log(data)\n\t\t\t\t\t\tthis.loading = false\n\t\t\t\t\t\tthis.$message.success(this.$store.getters.$lang.messages.successBuild)\n\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\tthis.loading = false\n\t\t\t\t\t\tthis.$message.error(this.$store.getters.$lang.messages.errorBuild)\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.description input {\n\t\tmax-width: 200px;\n\t}\n</style>\n","\n.description input {\n\tmax-width: 200px;\n}\n\n\n/*# sourceMappingURL=chunk-3a6102b3.a25ea116.css.map*/"]}